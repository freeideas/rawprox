# Untested Req
**Timestamp:** 2025-11-02-13-33-37

---

## Prompt

Please follow these instructions: @./the-system/prompts/WRITE_TEST.md

Create test for requirement:
  $REQ_ID: $REQ_ARGS_001
  Flow file: reqs\error-handling.md
  Source: ./readme/MCP_SERVER.md (Section: "Start-up Behavior")
  Requirement text: When started without arguments and without `--mcp` flag, RawProx must show help text (from HELP.md) to STDERR.


---

## Response

## Summary

Created test file: `./tests/failing/test_error_handling.py`

**Flow tested:** error-handling (reqs/error-handling.md)

**Requirements covered:**
- $REQ_ARGS_001: Help text to STDERR
- $REQ_ARGS_006: Exit code 1 on help display
- $REQ_ARGS_007: No NDJSON on help exit
- $REQ_ARGS_003: Invalid port rule format
- $REQ_ARGS_004: Port rule format validation
- $REQ_ARGS_005: Log destination format validation
- $REQ_ARGS_011: Accept MCP flag
- $REQ_MCP_001: Start with MCP flag
- $REQ_MCP_002: Random port selection (10000-65500)
- $REQ_MCP_003: Emit start-mcp event
- $REQ_MCP_005: JSON-RPC protocol
- $REQ_MCP_013: add-port-rule method
- $REQ_MCP_014: add-port-rule parameters
- $REQ_MCP_020: Error response format
- $REQ_MCP_024: Port conflict error message
- $REQ_STARTUP_005: Port already in use error
- $REQ_MCP_017: shutdown method
- $REQ_MCP_018: Shutdown behavior
- $REQ_SHUTDOWN_002: Close all connections
- $REQ_SHUTDOWN_003: Stop all listeners
- $REQ_SHUTDOWN_004: Flush buffered logs

**Test approach:**
1. Tests help display with no args (STDERR output, exit code 1, no STDOUT)
2. Tests invalid argument formats (port rules and log destinations)
3. Starts MCP server with `--mcp` flag
4. Verifies start-mcp event with port in valid range
5. Connects via TCP and sends JSON-RPC requests
6. Tests add-port-rule with valid parameters
7. Tests port conflict error handling
8. Tests graceful shutdown via shutdown method

Note: $REQ_PROXY_012 (UDP not supported) is architectural -- verified by absence of UDP code, not tested behaviorally.

