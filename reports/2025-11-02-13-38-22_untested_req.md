# Untested Req
**Timestamp:** 2025-11-02-13-38-22

---

## Prompt

Please follow these instructions: @./the-system/prompts/WRITE_TEST.md

Create test for requirement:
  $REQ_ID: $REQ_ARGS_012
  Flow file: reqs\simple-proxy-session.md
  Source: ./README.md (Section: "Command-Line Format")
  Requirement text: If a port rule doesn't follow the format `LOCAL_PORT:TARGET_HOST:TARGET_PORT`, RawProx must show an error and exit.


---

## Response

## Summary

Created test file: `./tests/failing/test_simple_proxy_session.py`

**Flow tested:** Simple Proxy Session (reqs/simple-proxy-session.md)

**Requirements covered:**
- $REQ_RUNTIME_001 - Single executable verification
- $REQ_RUNTIME_006 - Release directory contains only rawprox.exe
- $REQ_BUILD_001 - No .pdb/.dll files in release
- $REQ_BUILD_003 - Executable placed in release directory
- **$REQ_ARGS_012 - Port rule format validation (primary focus)**
- $REQ_ARGS_015 - Flexible argument order
- $REQ_STARTUP_008 - Start with single port rule
- $REQ_RUNTIME_003 - Direct execution
- $REQ_STARTUP_009 - Listen on configured ports
- $REQ_PROXY_018 - Accept connections
- $REQ_PROXY_023 - Forward traffic bidirectionally
- $REQ_STDOUT_001 - Default to STDOUT
- $REQ_STDOUT_002 - NDJSON format
- $REQ_STDOUT_003 - One JSON object per line
- $REQ_STDOUT_016 - Connection open events
- $REQ_STDOUT_022 - Unique connection IDs
- $REQ_STDOUT_009 - ISO 8601 timestamps
- $REQ_STDOUT_021 - Traffic data events
- $REQ_STDOUT_018 - Connection close events

**Test approach:**
1. Verifies build artifacts (single exe, no extra files)
2. Tests invalid port rule formats to verify $REQ_ARGS_012 error handling
3. Starts a simple echo server on port 45678
4. Launches RawProx with valid port rule `34567:127.0.0.1:45678`
5. Verifies port binding and connection acceptance
6. Sends test data through proxy and verifies bidirectional forwarding
7. Validates NDJSON log format with open/data/close events
8. Checks timestamp format and connection tracking

