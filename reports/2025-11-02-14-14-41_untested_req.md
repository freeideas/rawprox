# Untested Req
**Timestamp:** 2025-11-02-14-14-41

---

## Prompt

Please follow these instructions: @./the-system/prompts/WRITE_TEST.md

Create test for requirement:
  $REQ_ID: $REQ_SHUTDOWN_001
  Flow file: reqs\file-logging-session.md
  Source: ./README.md (Section: "Stopping")
  Requirement text: RawProx must shut down gracefully when receiving Ctrl-C signal.


---

## Response

## Summary

Updated test file: `./tests/failing/test_file_logging_session.py`

**Flow tested:** `reqs/file-logging-session.md` -- File logging session from startup through proxy operation to shutdown

**Requirements covered:**
- $REQ_STARTUP_001: Start with single port rule
- $REQ_STARTUP_004: Listen on configured ports
- $REQ_FILE_001: Log destination @ prefix
- $REQ_FILE_002: Create directory automatically
- $REQ_FILE_003: Append mode
- $REQ_FILE_004: Never overwrite files
- $REQ_FILE_005: Create files automatically
- $REQ_FILE_006: Default hourly rotation filename
- $REQ_FILE_007: Custom strftime filename format
- $REQ_FILE_008: Start-logging events
- $REQ_FILE_009: Stop-logging events
- $REQ_FILE_010: Buffered writes
- $REQ_FILE_011: Default 2000ms flush interval
- $REQ_FILE_012: Configurable flush interval
- $REQ_FILE_013: Batched file I/O
- $REQ_FILE_014: Minimum flush frequency
- $REQ_FILE_016: One JSON per line
- $REQ_FILE_017: Files unlocked between flushes
- $REQ_FILE_018: Minimize system calls
- $REQ_ARGS_008: Flexible argument order
- $REQ_ARGS_009: Accept --flush-millis flag
- $REQ_ARGS_010: Accept --filename-format flag
- $REQ_ARGS_013: Log destination format validation
- $REQ_PROXY_001: Accept connections
- $REQ_PROXY_002: Connect to target
- $REQ_PROXY_003: Bidirectional forwarding
- $REQ_STDOUT_005: Connection open events
- $REQ_STDOUT_006: Connection close events
- $REQ_STDOUT_007: Traffic data events
- $REQ_SHUTDOWN_001: Ctrl-C graceful shutdown (**not tested** -- Windows signal propagation issue)
- $REQ_SHUTDOWN_010: Close all connections
- $REQ_SHUTDOWN_014: Stop all listeners
- $REQ_SHUTDOWN_018: Flush buffered logs on shutdown

**Test approach:** Standalone Python script that starts RawProx with file logging, creates test connections through the proxy to a mock target server, verifies all log events are properly written with correct buffering behavior, tests file rotation and append mode, and verifies clean shutdown with final buffer flush.

