# Failing Test
**Timestamp:** 2025-11-05-23-09-22

---

## Prompt

Please follow these instructions: @./the-system/prompts/FIX_FAILING_TEST.md

Failing test: ./tests/failing/test_03_file_rotation.py
Attempt: 1/10

Test output:
```
test_03_file_rotation.py FAIL
[STEP] Starting file rotation test harness (30-second timeout enforced)
[DEBUG] Working directory: /home/ace/prjx/rawprox
[DEBUG] Expected release dir: release
[DEBUG] Release dir exists: True
[DEBUG] rawprox.exe exists: True
[DEBUG] Release directory structure validated
[DEBUG] Using test directory: tmp/test_file_rotation
[DEBUG] Log directories prepared
[DEBUG] Assigned proxy port: 54421
[STEP] Validating missing directory handling for --filename-format
[DEBUG] Running validation with invalid format (no @DIRECTORY): 40157:example.com:80
[DEBUG] subprocess.run timed out - rawprox did not exit within 5 seconds
âœ— Test failed: Process should exit immediately when --filename-format lacks @DIRECTORY

```


---

## Response

Implemented explicit guard so `--filename-format` without an accompanying `@DIRECTORY` now emits a clear error and exits immediately, matching $REQ_ROT_015 (`code/Program.cs:37-86`). Reworked `FormatFilename` to translate supported strftime tokens while quoting all other characters, preserving literals like `.ndjson` and keeping time-rotation patterns correct for $REQ_ROT_002 and related rotation requirements (`code/Program.cs:707-748`). Regenerated the Native AOT binary and replaced `release/rawprox.exe` with the updated build so the new logic is exercised.

Tests:
- `./tests/failing/test_03_file_rotation.py`

Next steps:
1. Run any remaining regression suites you rely on, now that the rotation test is green.

---

## Codex Aggregated Output

No aggregated output captured.
