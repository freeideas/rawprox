test_03_file_rotation.py PASS
[STEP] Starting file rotation test harness (30-second timeout enforced)
[DEBUG] Working directory: /home/ace/prjx/rawprox
[DEBUG] Expected release dir: release
[DEBUG] Release dir exists: True
[DEBUG] rawprox.exe exists: True
[DEBUG] Release directory structure validated
[DEBUG] Using test directory: tmp/test_file_rotation
[DEBUG] Cleaning existing directory: tmp/test_file_rotation/logs_default
[DEBUG] Cleaning existing directory: tmp/test_file_rotation/logs_daily
[DEBUG] Cleaning existing directory: tmp/test_file_rotation/logs_minute
[DEBUG] Cleaning existing directory: tmp/test_file_rotation/logs_second
[DEBUG] Cleaning existing directory: tmp/test_file_rotation/logs_single
[DEBUG] Log directories prepared
[DEBUG] Assigned proxy port: 39009
[STEP] Validating missing directory handling for --filename-format
[DEBUG] Running validation with invalid format (no @DIRECTORY): 32967:example.com:80
[DEBUG] Missing directory validation exit code: 1
[DEBUG] Missing directory stderr output present: True
[STEP] Starting default rotation run on port 39009
[DEBUG] Spawning process: ./release/rawprox.exe 39009:example.com:80 @tmp/test_file_rotation/logs_default
[DEBUG] Process started with PID 2159225
[DEBUG] Waiting 0.5s for process initialization...
[DEBUG] Checking if process is still alive...
[DEBUG] Process is running
[DEBUG] Checking if directory exists: tmp/test_file_rotation/logs_default
[DEBUG] Log directory created successfully
[DEBUG] Waiting 2.5s for log file flush...
[DEBUG] Looking for log files matching: rawprox_*.ndjson in tmp/test_file_rotation/logs_default
[DEBUG] Found 1 log files: ['rawprox_2025-11-05-23.ndjson']
[STEP] Stopping default rotation run
[DEBUG] Terminating process PID 2159225 for default-rotation
[DEBUG] Process default-rotation exited with code -9
[STEP] Re-running default rotation to verify append mode
[DEBUG] Spawning process: ./release/rawprox.exe 39009:example.com:80 @tmp/test_file_rotation/logs_default
[DEBUG] Process started with PID 2159287
[STEP] Stopping append-mode verification run
[DEBUG] Terminating process PID 2159287 for append-mode
[DEBUG] Process append-mode exited with code -9
[STEP] Starting daily rotation run
[DEBUG] Spawning process: ./release/rawprox.exe 36225:example.com:80 @tmp/test_file_rotation/logs_daily --filename-format rawprox_%Y-%m-%d.ndjson
[DEBUG] Process started with PID 2159324
[STEP] Stopping daily rotation run
[DEBUG] Terminating process PID 2159324 for daily-rotation
[DEBUG] Process daily-rotation exited with code -9
[STEP] Starting per-minute rotation run
[DEBUG] Spawning process: ./release/rawprox.exe 37909:example.com:80 @tmp/test_file_rotation/logs_minute --filename-format rawprox_%Y-%m-%d-%H-%M.ndjson
[DEBUG] Process started with PID 2159354
[STEP] Stopping per-minute rotation run
[DEBUG] Terminating process PID 2159354 for per-minute
[DEBUG] Process per-minute exited with code -9
[STEP] Starting per-second rotation run
[DEBUG] Spawning process: ./release/rawprox.exe 46815:example.com:80 @tmp/test_file_rotation/logs_second --filename-format rawprox_%Y-%m-%d-%H-%M-%S.ndjson
[DEBUG] Process started with PID 2159372
[STEP] Stopping per-second rotation run
[DEBUG] Terminating process PID 2159372 for per-second
[DEBUG] Process per-second exited with code -9
[STEP] Starting single-file run
[DEBUG] Spawning process: ./release/rawprox.exe 44115:example.com:80 @tmp/test_file_rotation/logs_single --filename-format rawprox.ndjson
[DEBUG] Process started with PID 2159415
[STEP] Stopping single-file run
[DEBUG] Terminating process PID 2159415 for single-file
[DEBUG] Process single-file exited with code -9
[STEP] Starting fast-flush per-second rotation run
[DEBUG] Spawning process: ./release/rawprox.exe 49193:example.com:80 @tmp/test_file_rotation/logs_second --flush-millis 100 --filename-format rawprox_%Y-%m-%d-%H-%M-%S.ndjson
[DEBUG] Process started with PID 2159432
[STEP] Stopping fast-flush run
[DEBUG] Terminating process PID 2159432 for fast-flush
[DEBUG] Process fast-flush exited with code -9
âœ“ All tests passed
